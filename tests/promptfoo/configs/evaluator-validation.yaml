# Test configuration for validating custom evaluators
description: "Validation tests for custom article guardrail evaluators"

providers:
  - id: file://providers/claude-code-provider.ts
    config:
      testMode: true
      model: claude-3-5-sonnet-20241022
      temperature: 0.3
      max_tokens: 4096

prompts:
  - file: ../.claude/commands/article_guardrail_review.md

tests:
  # Test Article Approval Evaluator
  - description: "Article Approval Evaluator - Clean Article"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721.md"
    assert:
      - type: javascript
        value: file://evaluators/article-approval-evaluator.ts
    metadata:
      expectedDecision: "APPROVED"
      evaluatorTest: "article-approval"

  - description: "Article Approval Evaluator - Violation Article"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721-guardrail-fail.md"
    assert:
      - type: javascript
        value: file://evaluators/article-approval-evaluator.ts
    metadata:
      expectedDecision: "BLOCKED"
      evaluatorTest: "article-approval"

  # Test Violation Detection Evaluator
  - description: "Violation Detection Evaluator - Multiple Violations"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721-guardrail-fail.md"
    assert:
      - type: javascript
        value: file://evaluators/violation-detection-evaluator.ts
    metadata:
      expectedViolations: 5
      evaluatorTest: "violation-detection"

  - description: "Violation Detection Evaluator - Clean Article"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721.md"
    assert:
      - type: javascript
        value: file://evaluators/violation-detection-evaluator.ts
    metadata:
      expectedViolations: 0
      evaluatorTest: "violation-detection"

  - description: "Violation Detection Evaluator - Confidential Info"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/violations/confidential-info.md"
    assert:
      - type: javascript
        value: file://evaluators/violation-detection-evaluator.ts
    metadata:
      expectedViolations: 1
      evaluatorTest: "violation-detection"

  # Test Format Compliance Evaluator
  - description: "Format Compliance Evaluator - Standard Response"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721.md"
    assert:
      - type: javascript
        value: file://evaluators/format-compliance-evaluator.ts
    metadata:
      evaluatorTest: "format-compliance"

  - description: "Format Compliance Evaluator - Empty File"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721-empty.md"
    assert:
      - type: javascript
        value: file://evaluators/format-compliance-evaluator.ts
    metadata:
      evaluatorTest: "format-compliance"

  # Test Response Quality Evaluator
  - description: "Response Quality Evaluator - Standard Response"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721.md"
    assert:
      - type: javascript
        value: file://evaluators/response-quality-evaluator.ts
    metadata:
      evaluatorTest: "response-quality"

  - description: "Response Quality Evaluator - Complex Violation Response"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721-guardrail-fail.md"
    assert:
      - type: javascript
        value: file://evaluators/response-quality-evaluator.ts
    metadata:
      evaluatorTest: "response-quality"

  # Combined Evaluator Tests
  - description: "All Evaluators - Standard Article"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721.md"
    assert:
      - type: javascript
        value: file://evaluators/article-approval-evaluator.ts
      - type: javascript
        value: file://evaluators/violation-detection-evaluator.ts
      - type: javascript
        value: file://evaluators/format-compliance-evaluator.ts
      - type: javascript
        value: file://evaluators/response-quality-evaluator.ts
    metadata:
      evaluatorTest: "comprehensive"

  - description: "All Evaluators - Violation Article"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/weekly-ai-digest-20250721-guardrail-fail.md"
    assert:
      - type: javascript
        value: file://evaluators/article-approval-evaluator.ts
      - type: javascript
        value: file://evaluators/violation-detection-evaluator.ts
      - type: javascript
        value: file://evaluators/format-compliance-evaluator.ts
      - type: javascript
        value: file://evaluators/response-quality-evaluator.ts
    metadata:
      evaluatorTest: "comprehensive"

  # Edge Case Tests
  - description: "Edge Case - Missing File"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/non-existent-file.md"
    assert:
      - type: javascript
        value: file://evaluators/format-compliance-evaluator.ts
      - type: javascript
        value: file://evaluators/response-quality-evaluator.ts
    metadata:
      evaluatorTest: "edge-case"

  - description: "Edge Case - Corrupted File"
    vars:
      articlePath: "tests/promptfoo/mocks/articles/edge-cases/corrupted-file.md"
    assert:
      - type: javascript
        value: file://evaluators/article-approval-evaluator.ts
      - type: javascript
        value: file://evaluators/format-compliance-evaluator.ts
    metadata:
      evaluatorTest: "edge-case"

# Test environment setup
defaultTest:
  options:
    provider:
      config:
        testMode: true

# Evaluation settings with detailed metrics
evaluateOptions:
  maxConcurrency: 1
  showProgressBar: true
  outputPath: ../test-results/evaluator-validation-results.json
  writeLatestResults: true
  
# Performance thresholds for evaluators
thresholds:
  # Overall test pass rate
  pass_rate: 0.8
  
  # Evaluator-specific thresholds
  article_approval_accuracy: 0.9
  violation_detection_accuracy: 0.8
  format_compliance_rate: 0.9
  response_quality_minimum: 0.6
  
# Reporting configuration  
reporting:
  includeMetrics: true
  includeFailureDetails: true
  detailedEvaluatorResults: true